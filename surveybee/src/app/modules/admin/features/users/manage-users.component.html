<mat-card class="manage-users-card">
  <div class="card-header">
    <div class="header-title">
      <h2>Manage Users</h2>
      <span class="header-subtitle">Administer all users and roles in your organization</span>
    </div>
  </div>
  <mat-divider></mat-divider>
  <mat-card-content>
    @if (isLoading) {
      <div class="loading-container">
        <mat-spinner diameter="40"></mat-spinner>
        <p>Loading users...</p>
      </div>
    }
    @if (errorMessage) {
      <div class="error-message">
        <mat-icon>error</mat-icon>
        <span>{{ errorMessage }}</span>
        <button mat-stroked-button color="primary" (click)="fetchUsers()">Retry</button>
      </div>
    }
    @if (!isLoading && !errorMessage) {
      <div>
        @if (users && users.length > 0) {
          <table mat-table [dataSource]="users" class="user-table modern-table mat-elevation-z4">
            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let user">
                <div class="user-info">
                  <span class="user-email">{{ user.email }}</span>
                </div>
              </td>
            </ng-container>
            <!-- Role Column -->
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef>Role</th>
              <td mat-cell *matCellDef="let user">
                <mat-chip [color]="user.role === 'Admin' ? 'primary' : 'accent'" selected class="role-chip">
                  {{ user.role }}
                </mat-chip>
              </td>
            </ng-container>
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let user">
                <div class="action-buttons">
                  <button mat-flat-button color="primary" (click)="makeAdmin(user)" [disabled]="user.role === 'Admin'" matTooltip="Promote to Admin">
                    Promote
                  </button>
                  <button mat-flat-button color="warn" (click)="deleteUser(user)" [disabled]="user.role === 'Admin'" matTooltip="Delete User">
                    Delete
                  </button>
                </div>
              </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>
        }
        @if (users && users.length === 0) {
          <div class="no-users">
            <mat-icon>group_off</mat-icon>
            <p>No users found.</p>
          </div>
        }
      </div>
    }
  </mat-card-content>
</mat-card>
