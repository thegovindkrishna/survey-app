<div class="user-dashboard">
  <!-- Header Navbar -->
  <header class="user-header">
    <div class="header-content">
      <div class="logo">
        <h2>SurveyBee</h2>
      </div>
      <div class="nav-links">
        <a class="nav-link active" (click)="refreshDashboard()">
          <i class="icon">üè†</i>
          <span>Dashboard</span>
        </a>
        <a class="nav-link" (click)="navigateTo('/user/dashboard')">
          <i class="icon">üè†</i>
          <span>Home</span>
        </a>
      </div>
      <div class="user-menu">
        <span class="user-name">{{ userName || 'User' }}</span>
        <button class="logout-btn" (click)="logout()">
          Logout
        </button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="dashboard-content">
    <mat-card class="user-dashboard-card">
      <mat-divider></mat-divider>
      <mat-card-content>
        @if (!isLoading && !errorMessage) {
          <div class="dashboard-welcome">
            <p>Welcome! Here you can see and attend available surveys, and view your submitted responses.</p>
          </div>
        }
        @if (isLoading) {
          <div class="dashboard-loading">
            <mat-spinner diameter="40"></mat-spinner>
            <p>Loading surveys...</p>
          </div>
        }
        @if (errorMessage) {
          <div class="dashboard-error">
            <mat-icon>error</mat-icon>
            {{ errorMessage }}
          </div>
        }
        
        @if (!isLoading && !errorMessage) {
          <div class="dashboard-header">
            <h1>User Dashboard</h1>
            <p>Welcome to SurveyBee - Participate in surveys and view your responses</p>
          </div>

          <!-- Statistics Cards -->
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-content">
                <div class="stat-number">{{ availableSurveys.length }}</div>
                <div class="stat-label">Available Surveys</div>
              </div>
              <div class="stat-icon">üìã</div>
            </div>

            <div class="stat-card">
              <div class="stat-content">
                <div class="stat-number">{{ userResponses.length }}</div>
                <div class="stat-label">Completed Surveys</div>
              </div>
              <div class="stat-icon">‚úÖ</div>
            </div>

            <div class="stat-card">
              <div class="stat-content">
                <div class="stat-number">{{ totalResponses }}</div>
                <div class="stat-label">Total Responses</div>
              </div>
              <div class="stat-icon">üìä</div>
            </div>

            <div class="stat-card">
              <div class="stat-content">
                <div class="stat-number">{{ surveyParticipationRate }}%</div>
                <div class="stat-label">Participation Rate</div>
              </div>
              <div class="stat-icon">üìà</div>
            </div>
          </div>

          <!-- Available Surveys Section -->
          <div class="surveys-section">
            <h2>Available Surveys</h2>
            <div class="section-actions">
              <button class="refresh-btn" (click)="refreshDashboard()" [disabled]="isLoading">
                Refresh
              </button>
            </div>
            
            @if (isLoading) {
              <div class="surveys-loading">
                <mat-spinner diameter="40"></mat-spinner>
                <p>Loading available surveys...</p>
              </div>
            }
            
            @if (!isLoading) {
              <div class="surveys-grid">
                @for (survey of availableSurveys; track survey.id) {
                  <div class="survey-card available">
                    <div class="survey-header">
                      <h3>{{ survey.title }}</h3>
                      <span class="survey-status active">Active</span>
                    </div>
                    <div class="survey-content">
                      <p class="survey-description">{{ survey.description }}</p>
                      <div class="survey-meta">
                        <span class="survey-date">{{ survey.startDate | date:'shortDate' }} - {{ survey.endDate | date:'shortDate' }}</span>
                        <span class="survey-questions">{{ survey.questions.length || 0 }} questions</span>
                      </div>
                    </div>
                    <div class="survey-actions">
                      <button class="action-btn primary" (click)="attendSurvey(survey.id)">
                        <i class="icon">‚ñ∂Ô∏è</i>
                        <span>Take Survey</span>
                      </button>
                    </div>
                  </div>
                }
                
                @if (availableSurveys.length === 0 && !isLoading) {
                  <div class="empty-state">
                    <div class="empty-icon">üì≠</div>
                    <h3>No Available Surveys</h3>
                    <p>There are no open surveys at the moment. Check back later!</p>
                  </div>
                }
              </div>
            }

            <!-- Pagination Controls for Available Surveys -->
            @if (getTotalPages() > 1) {
              <div class="pagination-container">
                <div class="pagination">
                  <button 
                    class="pagination-btn" 
                    [disabled]="currentPage === 1" 
                    (click)="previousPage()">
                    ‚Üê Previous
                  </button>
                  
                  <span class="pagination-pages">
                    @for (page of getPageNumbers(); track page) {
                      <button 
                        class="pagination-btn" 
                        [class.active]="page === currentPage"
                        (click)="goToPage(page)">
                        {{ page }}
                      </button>
                    }
                  </span>
                  
                  <button 
                    class="pagination-btn" 
                    [disabled]="currentPage === getTotalPages()" 
                    (click)="nextPage()">
                    Next ‚Üí
                  </button>
                </div>
                
                <div class="pagination-info">
                  Showing {{ ((currentPage - 1) * pageSize) + 1 }} - {{ Math.min(currentPage * pageSize, totalCount) }} of {{ totalCount }} surveys
                </div>
              </div>
            }
          </div>

          <!-- Completed Surveys Section -->
          <div class="surveys-section">
            <h2>Your Completed Surveys</h2>
            <div class="surveys-grid">
              @for (response of userResponses; track response.id) {
                <div class="survey-card completed">
                  <div class="survey-header">
                    <h3>{{ response.surveyTitle }}</h3>
                    <span class="survey-status completed">Completed</span>
                  </div>
                  <div class="survey-content">
                    <p class="survey-description">{{ response.surveyDescription }}</p>
                    <div class="survey-meta">
                      <span class="survey-date">Submitted: {{ response.submissionDate | date:'short' }}</span>
                      <span class="survey-responses">{{ response.responses.length || 0 }} responses</span>
                    </div>
                  </div>
                  <div class="survey-actions">
                    <button class="action-btn secondary" (click)="viewResponse(response.id)">
                      <i class="icon">üëÅÔ∏è</i>
                      <span>View Response</span>
                    </button>
                  </div>
                </div>
              }
              
              @if (userResponses.length === 0) {
                <div class="empty-state">
                  <div class="empty-icon">üìÑ</div>
                  <h3>No Completed Surveys</h3>
                  <p>You haven't completed any surveys yet. Take a survey above to get started!</p>
                </div>
              }
            </div>
          </div>

          <!-- Recent Activity -->
          <div class="recent-activity">
            <h2>Recent Activity</h2>
            <div class="activity-list">
              @for (activity of recentActivity; track $index) {
                <div class="activity-item">
                  <div class="activity-icon">{{ activity.icon }}</div>
                  <div class="activity-content">
                    <div class="activity-title">{{ activity.title }}</div>
                    <div class="activity-description">{{ activity.description }}</div>
                    <div class="activity-time">{{ activity.time }}</div>
                  </div>
                </div>
              }
              
              @if (recentActivity.length === 0) {
                <div class="empty-state">
                  <div class="empty-icon">üîÑ</div>
                  <p>No recent activity to show.</p>
                </div>
              }
            </div>
          </div>
        }
      </mat-card-content>
    </mat-card>
  </main>
</div>
