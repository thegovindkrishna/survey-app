<div class="results-detail-container">
  @if (isLoading) {
    <div class="loading">Loading survey analytics...</div>
  } @else if (error) {
    <div class="error">{{ error }}</div>
  } @else if (survey) {
    <h2>{{ survey.surveyTitle || 'Unknown Survey' }}</h2>
    <div class="meta">
      <span>Total Responses: <b>{{ survey.totalResponses || 0 }}</b></span>
    </div>
    
    @if (survey.questionResults && survey.questionResults.length > 0) {
      <div class="questions-analytics">
        @for (q of survey.questionResults; track q?.questionId || $index) {
          <div class="question-block">
            <h4>{{ q?.questionText || 'Unknown Question' }}</h4>
            @if (q?.questionType === 'rating') {
              <div>
                <div>Average Rating: <b>{{ q?.averageRating?.toFixed(2) ?? 'N/A' }}</b></div>
                <div class="bar-chart">
                  @for (opt of getKeys(q?.responseCounts); track opt) {
                    <div class="bar-row">
                      <span class="bar-label">{{ opt }}</span>
                      <div class="bar" [style.width.%]="getBarWidth(q?.responseCounts, opt, survey.totalResponses)">
                        {{ (q?.responseCounts && q.responseCounts[opt]) || 0 }}
                      </div>
                    </div>
                  }
                </div>
              </div>
            }
            @if (q?.questionType !== 'rating') {
              <div>
                <div class="bar-chart">
                  @for (opt of getKeys(q?.responseCounts); track opt) {
                    <div class="bar-row">
                      <span class="bar-label">{{ opt }}</span>
                      <div class="bar" [style.width.%]="getBarWidth(q?.responseCounts, opt, survey.totalResponses)">
                        {{ (q?.responseCounts && q.responseCounts[opt]) || 0 }}
                      </div>
                    </div>
                  }
                </div>
              </div>
            }
          </div>
        }
      </div>
    } @else {
      <div class="no-results">
        <h3>No Question Results Available</h3>
        <p>This survey either has no responses yet or there was an issue loading the results.</p>
      </div>
    }
  } @else {
    <div>No survey analytics found.</div>
  }
</div>
